---
title: "Optimierung der Preisstrategien bei Airbnb: Eine Analyse zur Maximierung der Einnahmen"
subtitle: "Eine datengetriebene Untersuchung der Faktoren, die zu höheren Buchungspreisen führen"
author: "Cedric Gisler & Jovan Pajic"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
execute:
  error: true
  echo: false
  message: false
  warning: false
format:
  ieee-pdf: default
editor: visual
bibliography: references.bib
---

```{=html}
<!--

Bei allen 3 regionen correlation matrix der Variablen vergleichen -\> Die mit einer Correlation filtern

Dozent fragen ob 2 oder 3 Methoden (Descriptive, Predictive, Prescriptive) umgesetzt werden muss

Eda beschreibe welche für uns relevant sind und erfrosche diese daten. Methode von eda durchführen

Sichtbarkeit Codeblox:

Hide source code: echo=FALSE

Hide text output: results = FALSE

Hide messages: message=FALSE

Hide warning messages: warning=FALSE

Hide plots: fig.show='hide'

-->
```
## 1. Abstrakt

```{=html}
<!--

Document Abstract \[1pt\]

-   Does it provide a comprehensible glipse of the project? \[0.5pt\]

-   Is the outcome teased? \[0.5pt\]
-->
```
Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

## 2. Einleitung (mit Forschungsfrage (d.h. Geschäftsfrage) am Ende)

In der heutigen, schnelllebigen Welt des Online-Tourismus spielen Plattformen wie Airbnb eine zentrale Rolle bei der Art und Weise, wie Menschen reisen und Unterkünfte buchen. Airbnb bietet eine Vielzahl von Unterkünften an, von einfachen Zimmern bis hin zu luxuriösen Villen. So vielfältig wie das Angebot sind auch die Vorlieben und Erwartungen der Gäste. Vor diesem Hintergrund stellt sich die Forschungsfrage: ***Welche Eigenschaften einer Airbnb-Unterkunft ziehen Gäste an und ermöglichen es, einen höheren Preis pro Apparment zu erzielen?***

Der grösste Unterschied eines Airbnbs ist deren Grösse. Eine der wichtigsten Eigenschaften eines Apartments ist aber die Lage, die Bewertung und der Gastgeber, somit definieren wir folgende Nullhypothesen:

1.  **Bewertung der Airbnb-Unterkünften:**

    -   **Nullhypothese (H0):** Die Höhe der Gesamtbewertung (review_scores_rating) hat keinen signifikanten Einfluss auf den Preis pro Person der Unterkunft.
    -   **Alternativhypothese (H1):** Die Höhe der Gesamtbewertung (review_scores_rating) hat einen signifikanten Einfluss auf den Preis pro Person der Unterkunft.
    -   **Fragen:**
        -   Hat die Gesamtbewertung der Unterkunft (review_scores_rating) einen signifikanten Einfluss auf den Preis pro Person?
        -   Gibt es bestimmte Bewertungsmetriken (z.B. Sauberkeit, Kommunikation), die den Preis pro Person stärker beeinflussen als andere?

2.  **Gastgeber der Airbnb-Unterkunft:**

    -   **Nullhypothese (H0):** Die Attribute des Hosts wie "host_is_superhost", "host_identity_verified" und "host_listings_count" haben keinen signifikanten Einfluss auf den Preis pro Person der Unterkunft.
    -   **Alternativhypothese (H1):** Die Attribute des Hosts wie "host_is_superhost", "host_identity_verified" und "host_listings_count" haben einen signifikanten Einfluss auf den Preis pro Person der Unterkunft.
    -   **Fragen:**
        -   Beeinflusst der Status "Superhost" (host_is_superhost) den Preis pro Person?

        -   Hat die Verifizierung des Hosts (host_identity_verified) einen Einfluss auf den Preis pro Person?

        -   Wie beeinflusst die Anzahl der Listings eines Hosts (host_listings_count) den Preis pro Person?

3.  **Lage des Airbnb:**

    -   **Nullhypothese (H0):** Die Entfernung zum Stadtzentrum (berechnet durch geografische Koordinaten) hat keinen signifikanten Einfluss auf den Preis pro Person der Unterkunft.

    -   **Alternativhypothese (H1):** Die Entfernung zum Stadtzentrum (berechnet durch geografische Koordinaten) hat einen signifikanten Einfluss auf den Preis pro Person der Unterkunft.

    -   **Fragen:**

        -   Beeinflusst die Entfernung zum Stadtzentrum den Preis pro Person der Unterkunft?
        -   Gibt es andere geografische Faktoren (z.B. Nähe zu bestimmten Attraktionen), die den Preis pro Person beeinflussen?

Weitere wichtige Eigenschaften sind Ereignisse (z.B. Zürich: Streetparade, Zürich Film Festival) in der betreffenden Stadt. Da wir aber die Daten nur zu einem einzelnen Zeitpunkt haben und keine Zeitserie, können wir den Einfluss dieser Ereignisse auf den Preis pro Person der Unterkunft nicht untersuchen.

**Deskriptive Analyse:** Wir möchten überprüfen, ob unsere Hypothesen so stimmen und wir mit unserer Annahme über die Einflüsse auf den Preis pro Person der Unterkunft richtig liegen.

**Prädiktive Analyse:** Wir möchten den Trend des Preises pro Person der Unterkunft aufzeigen und untersuchen, ob wir mithilfe der Bewertung und den wichtigsten Eigenschaften einer Unterkunft eine Prognose über den Preis machen können.

**Präskriptive Analyse:** Wir möchten zeigen, welche Eigenschaften wie verbessert werden müssen, um die Preise pro Person der Unterkunft signifikant erhöhen zu können, um einen höheren Preis erzielen zu können.

## 3. Datenquelle (mit Angaben zu Quelle, Qualität und Bereinigungsschritten der Daten)

```{=html}
<!--

Data set \[2.5pt\] -\> Yes Jovan

Comprises the data set a resonable amount of observations to answer the BI questions? \[1pt\] -\> Yes

Bring the additional data set new information to the basic data set? \[1pt\] -\> Yes

Are all data set accessible linked in documentation? \[0.5pt\] -\> Yes
-->
```
Die Daten für diese Analyse stammen von der Inside Airbnb Organisation [@inside-airbnb-2023], die sich dafür einsetzt, ihre Gemeinden vor den negativen Auswirkungen von Kurzzeitvermietungen zu schützen. Diese Organisation sammelt und veröffentlicht regelmässig aktualisierte Datensätze, die aus öffentlich verfügbaren Informationen auf der Airbnb-Website stammen. Diese Datensätze würden wir als Vertrauenswürdig einstufen.

Die extrahierten Datensätze umfassen Informationen aus drei bedeutenden Regionen in der Schweiz: Zürich (27. Dezember 2023), Genénve (27. Dezember 2023) und Vaud (10. März 2024).

Die Daten umfassen verschiedene Dateien für jede Stadt, wobei für die Analyse hauptsächlich das "listings_long.csv"-File verwendet wird, da es für die Geschäftsfragen relevant ist. Die Qualität der Daten in diesem File ist insgesamt sehr hoch, mit wenigen leeren Feldern und einer konsistenten Struktur innerhalb der Spalten.

Es werden insgesamt 3 Datensätze verwendet, die dieselbe Struktur aufweisen, jedoch aus drei verschiedenen Regionen stammen, die wir hier analysieren möchten.

Einige Spalten, wie "description", "neighborhood_overview", "host_neighborhood", "neighborhood", und die Beschreibung der Liegenschaft, wie "bathrooms" und "bedrooms", weisen eine beträchtliche Anzahl leerer Felder auf. Es wird vermutet, dass diese Felder optional für die Gastgeber sind und daher nicht immer ausgefüllt werden. Ebenso fehlt bei einigen Einträgen der Preis, was eine Analyse erfordert, um mögliche Korrelationen mit anderen Feldern, wie dem ersten Review, zu identifizieren.

Trotz dieser kleinen Unregelmässigkeiten ist die Datenqualität insgesamt hoch, und die Beschreibung der Datenfelder wird durch das Data Dictionary [@inside-airbnb-2022] gut unterstützt.

**Datenbereinigungsschritte:**

1.  **Entfernung irrelevanter oder leerer Spalten:** Vor der Analyse wurden alle Spalten entfernt, die für die Fragestellungen nicht relevant sind oder leere Felder enthalten.

2.  **Überprüfung der Einheitlichkeit und Konsistenz der Werte:** Die verbleibenden Spalten wurden auf Einheitlichkeit der Werte und Konsistenz der "N/A"-Kennzeichnungen überprüft, um sicherzustellen, dass die Daten konsistent und interpretierbar sind.

3.  **Analyse von Einträgen ohne Preisangabe:** Einige Einträge weisen keine Preisangabe auf, was eine Analyse erfordert, um mögliche Korrelationen mit anderen Feldern, wie dem ersten Review, zu identifizieren. Je nach Ergebnis dieser Analyse könnten Einträge ohne Preisangabe entfernt oder anderweitig behandelt werden, um die Datenintegrität zu gewährleisten.

## 4. Datenqualität (Analyse im Hinblick auf Datenqualitätsaspekte)

```{=html}
<!--

ETL \[3pt\] Jovan

How qualitative (detailed) is the ETL/EDA process done? \[1pt\]

What are the findings and how are they discussed? \[1pt\]

Was the data set cleaned with reasonable approaches? \[1pt\]
-->
```
```{r setup}
# load packages
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(caret)
library(randomForest)
library(summarytools)
```

```{r import}
df_zuerich <- read_csv(here::here("dataSource/Zurich/listings_long.csv/listings.csv"), show_col_types = FALSE)

df_vaud <- read_csv(here::here("dataSource/Vaud/listings_long.csv/listings.csv"), show_col_types = FALSE)

df_geneva <- read_csv(here::here("dataSource/Geneva/listings_long.csv/listings.csv"), show_col_types = FALSE)
```

```{r, results="hide"}
#View(df_zuerich)
#str(df_zuerich)
#summary(df_zuerich)
```

Nachdem wir die Zusammenfassung der Daten betrachtet und eine detaillierte Analyse der Dataframes durchgeführt haben, haben wir die folgenden Datenanpassungen vorgenommen:

1.  Konvertiere **`host_response_rate`** von Zeichenfolge (chr) in Ganzzahl (integer), wobei "N/A" durch NA ersetzt wird. Entferne das Prozentzeichen (%) und benenne die Spalte in **`host_response_rate_in_%`** um.

2.  Konvertiere **`host_acceptance_rate`** von Zeichenfolge (chr) in Ganzzahl (integer), wobei "N/A" durch NA ersetzt wird. Entferne das Prozentzeichen (%) und benenne die Spalte in **`host_acceptance_rate_in_%`** um.

3.  Konvertiere **`price`** von Zeichenfolge (chr) in Dezimalzahl (double), wobei das Dollarzeichen (\$) entfernt wird. Benenne die Spalte in **`price_in_$`** um.

4.  Lösche die folgenden Spalten: **`description`**, **`neighborhood_overview`**, **`host_location`**, **`host_about`**, **`host_neighbourhood`**, **`host_verifications`**, **`neighbourhood`**, **`neighbourhood_cleansed`**, **`bathrooms`**, **`bedrooms`**, **`amenities`**, **`calendar_updated`** , **`license`**.

5.  Analysiere fehlende Werte (NA) oder leere Felder und ersetze sie gegebenenfalls.

```{r data cleaning zuerich}

df_zuerich_cleanead <- df_zuerich %>%
  mutate(host_response_rate_in_percent = as.integer(gsub("%", "", na_if(host_response_rate, "N/A"))),
         host_acceptance_rate_in_percent = as.integer(gsub("%", "", na_if(host_acceptance_rate, "N/A"))),
         price_in_usd = as.numeric(ifelse(grepl("\\$[0-9.]+", price), gsub("\\$", "", price), "N/A"))
         ) %>%
  filter(!is.na(price_in_usd)) %>%
  select(-description, 
         -neighborhood_overview, 
         -host_location, 
         -host_about, 
         -host_neighbourhood, 
         -host_verifications,
         -host_acceptance_rate,
         -host_response_rate,
         -neighbourhood, 
         -neighbourhood_cleansed, 
         -bathrooms, 
         -bedrooms, 
         -amenities,
         -price,
         -calendar_updated,
         -license)

#Umwandeln der verschiedenen NA Werte in korrekte N/A Werte von R:
na_formats <- c("N/A", "n/a", "na", "NA")  # Alle möglichen NA-Formate
df_zuerich_cleanead <- df_zuerich_cleanead %>%
  mutate(across(everything(), ~ifelse(. %in% na_formats, NA, .)))
```

```{r data cleaning vaud}

df_vaud_cleanead <- df_vaud %>%
  mutate(host_response_rate_in_percent = as.integer(gsub("%", "", na_if(host_response_rate, "N/A"))),
         host_acceptance_rate_in_percent = as.integer(gsub("%", "", na_if(host_acceptance_rate, "N/A"))),
         price_in_usd = as.numeric(ifelse(grepl("\\$[0-9.]+", price), gsub("\\$", "", price), "N/A"))
         ) %>%
  #filter(!is.na(price_in_usd)) %>%
  select(-description, 
         -neighborhood_overview, 
         -host_location, 
         -host_about, 
         -host_neighbourhood, 
         -host_verifications,
         -host_acceptance_rate,
         -host_response_rate,
         -neighbourhood, 
         -neighbourhood_cleansed, 
         -bathrooms, 
         -bedrooms, 
         -amenities,
         -price,
         -calendar_updated,
         -license)

#Umwandeln der verschiedenen NA Werte in korrekte N/A Werte von R:
na_formats <- c("N/A", "n/a", "na", "NA")  # Alle möglichen NA-Formate
df_vaud_cleanead <- df_vaud_cleanead %>%
  mutate(across(everything(), ~ifelse(. %in% na_formats, NA, .)))
```

```{r data cleaning geneva}

df_geneva_cleanead <- df_geneva %>%
  mutate(host_response_rate_in_percent = as.integer(gsub("%", "", na_if(host_response_rate, "N/A"))),
         host_acceptance_rate_in_percent = as.integer(gsub("%", "", na_if(host_acceptance_rate, "N/A"))),
         price_in_usd = as.numeric(ifelse(grepl("\\$[0-9.]+", price), gsub("\\$", "", price), "N/A"))
         ) %>%
  #filter(!is.na(price_in_usd)) %>%
  select(-description, 
         -neighborhood_overview, 
         -host_location, 
         -host_about, 
         -host_neighbourhood, 
         -host_verifications,
         -host_acceptance_rate,
         -host_response_rate,
         -neighbourhood, 
         -neighbourhood_cleansed, 
         -bathrooms, 
         -bedrooms, 
         -amenities,
         -price,
         -calendar_updated,
         -license)

#Umwandeln der verschiedenen NA Werte in korrekte N/A Werte von R:
na_formats <- c("N/A", "n/a", "na", "NA")  # Alle möglichen NA-Formate
df_geneva_cleanead <- df_geneva_cleanead %>%
  mutate(across(everything(), ~ifelse(. %in% na_formats, NA, .)))
```

```{r, results="hide"}
colnames(df_zuerich_cleanead)
```

Um die Daten nach der Bereinigung zu überprüfen und einen Überblick zu erhalten, führen wir eine standardmässige Datenanalysen durch am Beispiel **`df_zuerich_cleanead`** .

```{r eda}

# Check for duplicates by id
duplicated_ids <- df_zuerich_cleanead %>% 
  group_by(id)  %>% 
  filter(n() > 1)

# Visualize the distributions
ggplot(df_zuerich_cleanead, aes(x = price_in_usd)) +
  geom_histogram(binwidth = 50, fill = "skyblue", color = "black") +
  labs(title = "Distribution of Price in USD")

ggplot(df_zuerich_cleanead, aes(x = review_scores_rating)) +
  geom_histogram(binwidth = 0.25, fill = "lightgreen", color = "black") +
  labs(title = "Distribution of Review Scores Rating")

ggplot(df_zuerich_cleanead, aes(x = reviews_per_month)) +
  geom_histogram(binwidth = 0.5, fill = "orange", color = "black") +
  labs(title = "Distribution of Reviews per Month")


```

## Beschreibe Eda Prozess!

Anomalie und Ausreisser analysieren und filtern

Da der Preis stark variiert, analysieren wir die Möglichkeit, den Preis pro Person zu berechnen. Dabei fällt auf, dass der Preis bei "Entire home/apt" für die maximale Anzahl der Gäste (**`accommodates`**) berechnet wird, was sinnvoll ist, da die gesamte Unterkunft gebucht wird. Bei "Private room" und "Shared room" hingegen wird der Preis mehrheitlich pro Person angegeben. Im Gegensatz dazu ist der Preis bei "Hotel room" wieder für die maximale Gästeanzahl festgelegt.

````{=html}
<!--
```{r}
df_zuerich %>%
  group_by(room_type) %>%
  summarise(count = n()) %>%
  arrange(desc(count))
```
-->
````

```{r price_per_person}
df_geneva_cleanead <- df_geneva_cleanead %>%
  mutate(price_per_person = ifelse(room_type %in% c("Entire home/apt", "Hotel room"), 
                                   price_in_usd / accommodates, 
                                   price_in_usd)) %>%
  na.omit()

df_zuerich_cleanead <- df_zuerich_cleanead %>%
  mutate(price_per_person = ifelse(room_type %in% c("Entire home/apt", "Hotel room"), 
                                   price_in_usd / accommodates, 
                                   price_in_usd)) %>%
  na.omit()

df_vaud_cleanead <- df_vaud_cleanead %>%
  mutate(price_per_person = ifelse(room_type %in% c("Entire home/apt", "Hotel room"), 
                                   price_in_usd / accommodates, 
                                   price_in_usd)) %>%
  na.omit()

```

```{r, results = FALSE}
sum(is.na(df_zuerich_cleanead))
```

```{r export}
# Exportieren des DataFrames df_zuerich_cleanead, df_vaud_cleanead & df_geneva_cleanead in eine CSV-Datei
write.csv(df_zuerich_cleanead, "df_zuerich_cleanead.csv", row.names = FALSE)
write.csv(df_vaud_cleanead, "df_vaud_cleanead.csv", row.names = FALSE)
write.csv(df_geneva_cleanead, "df_geneva_cleanead.csv", row.names = FALSE)

```

## 5. Datenanalyse (Informationen zur Datenstruktur, Organisation und zu den für die Analyse verwendeten Methoden)

```{=html}
<!--

*Data analysis \[2pt\] Cedric / Jovan*

*Are data attributes clear and obvious discussed? \[1pt\]* -> dictonary

*Are adequate EDA methodologies used for data analysis? \[1pt\]* 

-->
```
### Datenstruktur und Organisation

Die vorliegenden bereinigten Datensets besteht aus Informationen zu Airbnb-Unterkünften in Zürich, Geneve und Vaud und umfasst 63 Variablen und mehrere tausend Zeilen, wobei jede Zeile eine einzelne Unterkunft repräsentiert. Die Variablen enthalten diverse Informationen, darunter:

-   **ID und URLs:** Eindeutige Identifikationsnummern und Links zu den Listings.

-   **Host-Informationen:** Daten über die Gastgeber, wie `host_id`, `host_name`, `host_is_superhost`, `host_identity_verified`, und `host_listings_count`.

-   **Eigenschaften der Unterkunft:** Variablen wie `accommodates`, `bedrooms`, `bathrooms`, `beds`, `price_in_usd`, und `price_per_person`.

-   **Bewertungen:** Bewertungsscores wie `review_scores_rating`, `review_scores_cleanliness`, `review_scores_checkin`, etc.

-   **Geografische Daten:** `latitude` und `longitude`.

-   **Verfügbarkeitsdaten:** `availability_30`, `availability_60`, `availability_90`, `availability_365`.

```{r}
dfSummary(df_zuerich_cleanead)
view(dfSummary(df_zuerich_cleanead))
```

```{r}
dfSummary(df_vaud_cleanead)
view(dfSummary(df_vaud_cleanead))
```

```{r}
dfSummary(df_geneva_cleanead)
view(dfSummary(df_geneva_cleanead))
```

### Methoden der Datenanalyse

Um die Forschungsfragen zu beantworten und die Hypothesen zu testen, wurden verschiedene statistische Methoden und Verfahren angewendet:

#### 1. **Deskriptive Statistik**

Die deskriptive Statistik liefert grundlegende Informationen über die Struktur und Verteilung der Daten. Ziel ist es, einen Überblick über die Daten zu bekommen und mögliche Anomalien oder interessante Muster zu erkennen.

-   **Ziel:** Ein grundlegendes Verständnis der Datenstruktur und Verteilung der Variablen zu erlangen.

-   **Massnahmen:** Berechnung von Mittelwerten, Mediane, Standardabweichungen und Visualisierung der Datenverteilung durch Histogramme und Boxplots.

Kurze Übersicht über die Datensets Zürich, Vaud und Gemeva

```{r}
# Deskriptive Statistik für numerische Variablen
summary(df_zuerich_cleanead$price_per_person)
summary(df_zuerich_cleanead$review_scores_rating)

# Histogramm für die Verteilung des Preises pro Person
ggplot(df_zuerich_cleanead, aes(x = price_per_person)) +
  geom_histogram(binwidth = 10, fill = "blue", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Verteilung des Preises pro Person in Zürich", x = "Preis pro Person", y = "Häufigkeit")

# Boxplot für den Preis pro Person
ggplot(df_zuerich_cleanead, aes(y = price_per_person)) +
  geom_boxplot(fill = "orange", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Boxplot des Preises pro Person in Zürich", y = "Preis pro Person")

# Histogramm für die Verteilung der Bewertung
ggplot(df_zuerich_cleanead, aes(x = review_scores_rating)) +
  geom_histogram(binwidth = 1, fill = "green", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Verteilung der Bewertung in Zürich", x = "Bewertung", y = "Häufigkeit")

# Boxplot für die Bewertung
ggplot(df_zuerich_cleanead, aes(y = review_scores_rating)) +
  geom_boxplot(fill = "purple", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Boxplot der Bewertung in Zürich", y = "Bewertung")
```

```{r}
# Deskriptive Statistik für numerische Variablen
summary(df_vaud_cleanead$price_per_person)
summary(df_vaud_cleanead$review_scores_rating)

# Histogramm für die Verteilung des Preises pro Person
ggplot(df_vaud_cleanead, aes(x = price_per_person)) +
  geom_histogram(binwidth = 10, fill = "blue", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Verteilung des Preises pro Person in Vaud", x = "Preis pro Person", y = "Häufigkeit")

# Boxplot für den Preis pro Person
ggplot(df_vaud_cleanead, aes(y = price_per_person)) +
  geom_boxplot(fill = "orange", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Boxplot des Preises pro Person in Vaud", y = "Preis pro Person")

# Histogramm für die Verteilung der Bewertung
ggplot(df_vaud_cleanead, aes(x = review_scores_rating)) +
  geom_histogram(binwidth = 1, fill = "green", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Verteilung der Bewertung in Vaud", x = "Bewertung", y = "Häufigkeit")

# Boxplot für die Bewertung
ggplot(df_vaud_cleanead, aes(y = review_scores_rating)) +
  geom_boxplot(fill = "purple", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Boxplot der Bewertung in Vaud", y = "Bewertung")
```

```{r}
# Deskriptive Statistik für numerische Variablen
summary(df_geneva_cleanead$price_per_person)
summary(df_geneva_cleanead$review_scores_rating)

# Histogramm für die Verteilung des Preises pro Person
ggplot(df_geneva_cleanead, aes(x = price_per_person)) +
  geom_histogram(binwidth = 10, fill = "blue", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Verteilung des Preises pro Person in Geneva", x = "Preis pro Person", y = "Häufigkeit")

# Boxplot für den Preis pro Person
ggplot(df_geneva_cleanead, aes(y = price_per_person)) +
  geom_boxplot(fill = "orange", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Boxplot des Preises pro Person in Geneva", y = "Preis pro Person")

# Histogramm für die Verteilung der Bewertung
ggplot(df_geneva_cleanead, aes(x = review_scores_rating)) +
  geom_histogram(binwidth = 1, fill = "green", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Verteilung der Bewertung in Geneva", x = "Bewertung", y = "Häufigkeit")

# Boxplot für die Bewertung
ggplot(df_zuerich_cleanead, aes(y = review_scores_rating)) +
  geom_boxplot(fill = "purple", color = "black", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Boxplot der Bewertung in Geneva", y = "Bewertung")
```

#### 2. **Korrelationsanalyse**

Die Korrelationsanalyse untersucht die Stärke und Richtung der Beziehung zwischen verschiedenen numerischen Variablen. Pearson-Korrelationskoeffizienten wurden berechnet, um zu quantifizieren, wie stark zwei Variablen miteinander variieren.

-   **Ziel:** Identifikation von Zusammenhängen zwischen den Variablen, insbesondere zwischen den Bewertungen, Host-Informationen, geografischen Daten und dem Preis pro Person.

-   **Massnahmen:** Berechnung von Pearson-Korrelationskoeffizienten und Erstellung von Korrelationsmatrizen.

```{r}
calculate_correlations <- function(data, city_name) {
  # Filter für die jeweilige Stadt
  
  # Auswahl der numerischen Spalten
  numerical_columns <- data %>%
    select(where(is.numeric)) %>%
    colnames()
  
  # Berechnung der Korrelationsmatrix
  correlation_matrix <- cor(data %>% select(all_of(numerical_columns)), use = "complete.obs")
  
  # Extraktion der Korrelationen mit 'price_per_person'
  correlation_with_price_per_person <- correlation_matrix["price_per_person", ] %>%
    sort(decreasing = TRUE)
  
  # Umwandlung in DataFrame
  correlation_df <- data.frame(
    Variable = names(correlation_with_price_per_person),
    Correlation = correlation_with_price_per_person
  )
  
  # Auswahl der 5 höchsten und 5 niedrigsten Korrelationen
  top_5 <- correlation_df %>% head(6) # including 'price_per_person' itself
  bottom_5 <- correlation_df %>% tail(5)
  
  # Zusammenfügen der Ergebnisse
  result <- bind_rows(top_5, bottom_5) %>% 
    filter(Variable != "price_per_person")
  
  # Ausgabe der Ergebnisse
  return(result)
}



print(calculate_correlations(df_zuerich_cleanead, "Zuerich"))


print(calculate_correlations(df_vaud_cleanead, "Vaud"))


print(calculate_correlations(df_geneva_cleanead, "Geneva"))

```

#### 3. **Lineare Regression**

Die lineare Regression wurde verwendet, um die Beziehung zwischen einer abhängigen Variable (Preis pro Person) und einer oder mehreren unabhängigen Variablen zu modellieren. Dies hilft, die Auswirkungen der unabhängigen Variablen auf die abhängige Variable zu quantifizieren und Vorhersagen zu treffen.

-   **Ziel:** Untersuchung des Einflusses einzelner Variablen (z.B. Bewertungen, Host-Attribute, Entfernung zum Stadtzentrum) auf den Preis pro Person.

-   **Massnahmen:** Aufbau mehrerer linearer Regressionsmodelle, um den Einfluss spezifischer unabhängiger Variablen auf die abhängige Variable (Preis pro Person) zu analysieren.

#### 4. **Visualisierung**

Visualisierungen sind ein wesentliches Werkzeug, um Datenmuster und Zusammenhänge intuitiv darzustellen und zu verstehen. Verschiedene Arten von Plots wurden verwendet, um die Ergebnisse der deskriptiven Statistik, der Korrelationsanalyse und der Regressionsmodelle zu visualisieren.

-   **Ziel:** Verständliche Darstellung der Ergebnisse und Identifikation von Mustern in den Daten.

-   **Massnahmen:** Erstellung von Scatterplots, Boxplots, Barplots und Heatmaps zur Visualisierung der Beziehungen zwischen den Variablen.

#### 5. Predictive Analysis

Zusätzlich zu den deskriptiven und inferenziellen Analysen wurde eine prädiktive Analyse durchgeführt, um den Preis pro Person basierend auf den verfügbaren Merkmalen vorherzusagen. Hierfür wurde ein Regressionsmodell mit mehreren Prädiktoren erstellt und evaluiert.

#### 5.1 Datenvorbereitung

-   **Feature Engineering:** Erstellung neuer Variablen, wie z.B. `distance_to_center`, und Transformation von kategorialen Variablen in numerische Werte.

-   **Train-Test-Split:** Aufteilung der Daten in Trainings- und Testdatensätze, um die Modellleistung zu evaluieren.

#### 5.2 Modelltraining und -evaluation

-   **Modelltraining:** Ein multiple lineares Regressionsmodell wurde auf den Trainingsdaten trainiert.

-   **Modellbewertung:** Das Modell wurde auf den Testdaten evaluiert, um die Vorhersagegenauigkeit zu beurteilen.

```         
```

## 6. Ergebnisse (statistische Ergebnisse, Zahlen, Diagramme)

```{=html}
<!--

Conclusion \[3pt\]

-   Are the initial BI problems reasonably discussed/solved? \[2pt\]

-   Are the obtained new insights of the data sets of good quality? \[1pt\]
-->
```
#### **Deskriptive Statistik**

#### K**orrelationsanalyse**

#### **Lineare Regression**

#### **Visualisierung**

#### Predictive Analysis

Die bereinigten Datensets der verschiedenen Orten sind alle gleich aufgebaut. Da wir den Preis der einzelnen Airbnb Apparment anschauen möchten ist dies unser wichtigster Wert:

```{r, results="hide"}
summary(df_zuerich_cleanead$price_per_person)
```

```{r, results = FALSE}
#Boxplot mit verbesserten Einstellungen für Achsen und Breite anzeigen 
ggplot(df_zuerich_cleanead, aes(y = price_per_person, x = 1)) +    geom_boxplot(fill = "blue", color = "black", alpha = 0.7, width = 0.2) +   labs(title = "Verteilung der Preise in USD", y = "Preis (USD)") +   theme_minimal() +   scale_x_continuous(expand = expansion(mult = c(0.5, 0.5)))    theme(axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank())  ggplot(df_zuerich_cleanead, aes(x = price_per_person)) +   geom_histogram(bins = 30, fill = "blue", color = "black", alpha = 0.7) +   labs(title = "Verteilung der Preise in USD", x = "Preis (USD)", y = "Anzahl der Einträge") +   theme_minimal()}
```

Nun ist stellt sich die Frage welche anderen Eigenschaften die grösste Auswirkung auf den Preis haben. Dazu gilt es herauszufinden wie die Korrelationen zwischen dem Preis pro USD und den anderen Attributen sind.

Die Korrelationen der verschiedenen Variablen mit dem Preis (**`price_per_person`**) im Datensatz können wichtige Einsichten bieten, welche Faktoren den Preis beeinflussen.

-   **Starke positive Korrelation:**

    -   **price_in_usd (0.45):** Der Gesamtpreis in USD zeigt eine starke positive Korrelation mit dem Preis pro Person. Dies ist intuitiv sinnvoll, da teurere Appartements auch höhere Preise pro Person haben.

    -   **availability_365 (0.19), availability_60 (0.16), availability_90 (0.16), availability_30 (0.16):** Die Verfügbarkeitsmetriken zeigen alle eine positive Korrelation, was darauf hindeutet, dass Appartements mit höheren Preisen pro Person tendenziell länger verfügbar sind.

-   **Starke negative Korrelation:**

    -   **accommodates (-0.25):** Die Anzahl der Personen, die eine Unterkunft aufnehmen kann, zeigt eine deutliche negative Korrelation. Größere Unterkünfte haben tendenziell niedrigere Preise pro Person.

    -   **host_total_listings_count (-0.20):** Gastgeber mit mehr Angeboten haben tendenziell niedrigere Preise pro Person, was auf Effizienz oder eine andere Preispolitik hinweisen könnte.

    -   **host_listings_count (-0.18):** Ähnlich wie bei der Gesamtanzahl der Listings, zeigt auch die Anzahl der Listings pro Gastgeber eine negative Korrelation.

-   **Moderate Korrelation:**

    -   **review_scores_location (0.11):** Der Standortbewertungs-Score zeigt eine moderate positive Korrelation. Bessere Lagen können höhere Preise pro Person rechtfertigen.

    -   **host_id (0.11), host_since (0.10):** Diese zeigen leichte positive Korrelationen, was darauf hindeutet, dass erfahrenere oder etablierte Gastgeber höhere Preise verlangen könnten.

-   **Geringe oder keine Korrelation:**

    -   **latitude (-0.04), longitude (0.04):** Geografische Koordinaten zeigen eine sehr geringe Korrelation, was darauf hinweist, dass die genaue Lage (abgesehen von den Stadtteilen) nicht stark mit dem Preis pro Person zusammenhängt.

    -   **review_scores_cleanliness (0.07), review_scores_accuracy (0.02), review_scores_communication (0.02):** Bewertungen in diesen Kategorien zeigen nur sehr geringe positive Korrelationen.

-   **Überraschend negative Korrelationen:**

    -   **number_of_reviews_l30d (-0.13):** Eine höhere Anzahl von Bewertungen in den letzten 30 Tagen korreliert negativ mit dem Preis pro Person, was darauf hindeuten könnte, dass viel frequentierte Unterkünfte eventuell günstigere Preise anbieten.

## 

<!--  Descriptive analysis \[7pt\]  1.  **Beschreibend (Descriptive)**: Deine Forschungsarbeit scheint beschreibende Analysen abzudecken, indem sie Merkmale von Airbnb-Unterkünften untersucht, die einen höheren Preis erzielen. Dies umfasst die Analyse der geografischen Lage, der Art der Unterkunft, der Anzahl der Zimmer und Bäder sowie der Verfügbarkeit von Annehmlichkeiten.  -   Was reasonable statistics used for data inspection and which attributes have been checked? \[2pt\]  -   Are the findings and statements qualitative? \[3pt\]  -   What are the conclusions of the findings? \[2pt\] -->

<!--  Predictive analysis \[7pt\]  1.  **Prädiktiv (Predictive)**: Um prädiktive Analysen einzubeziehen, könnte deine Fragestellung erweitert werden, um Vorhersagemodelle zu entwickeln, die den erzielbaren Preis basierend auf bestimmten Merkmalen der Unterkünfte prognostizieren. Dies könnte beispielsweise die Frage beinhalten: "Welche Merkmale einer Airbnb-Unterkunft sind prädiktive Indikatoren für einen höheren Preis?" 2.  **Wir möchten den Trend des Preises pro Person der Unterkunft aufzeigen und untersuchen, ob wir mithilfe der Bewertung und den wichtigsten Eigenschaften einer Unterkunft eine Prognose über den Preis machen können.** 3.  Are the applied methods goal orientated? \[2pt\] 4.  Were the applied methods qualitatively performed? \[3pt\] 5.  What are the conclusions of the findings? \[2pt\] -->

```{r predictive}
set.seed(123) trainIndex <- createDataPartition(df_zuerich_cleanead$price_per_person, p = .8,                                    list = FALSE,                                    times = 1) trainData <- df_zuerich_cleanead[ trainIndex,] testData <- df_zuerich_cleanead[-trainIndex,]  # Training des Modells model <- randomForest(price_per_person ~ availability_365  + review_scores_rating + number_of_reviews,                        data = trainData,                        ntree = 500)  # Evaluierung des Modells predictions <- predict(model, testData) rmse <- sqrt(mean((predictions - testData$price_per_person)^2)) mae <- mean(abs(predictions - testData$price_per_person)) r2 <- 1 - sum((predictions - testData$price_per_person)^2) / sum((mean(testData$price_per_person) - testData$price_per_person)^2)  # Ergebnisse anzeigen cat("RMSE:", rmse, "\n") cat("MAE:", mae, "\n") cat("R²:", r2, "\n")  # Schlussfolgerungen importance <- importance(model) print(importance)}
```

Die vorliegende Predictive Analyse zielt darauf ab, den Trend des Preises pro Person einer Unterkunft aufzuzeigen und zu untersuchen, ob mithilfe der Bewertung und den wichtigsten Eigenschaften einer Unterkunft eine Prognose über den Preis gemacht werden kann. Dabei wurden Verfügbarkeit (availability_365), Bewertung (review_scores_rating) und Anzahl der Bewertungen (number_of_reviews) als Prädiktoren herangezogen.

Die Modellbewertung zeigt folgende Ergebnisse:

-   **RMSE: 41.90135** – Der durchschnittliche quadratische Fehler beträgt 41.90 USD, was auf erhebliche Abweichungen zwischen den vorhergesagten und tatsächlichen Preisen hinweist.

-   **MAE: 27.91819** – Der mittlere absolute Fehler beträgt 27.92 USD, was ebenfalls auf erhebliche Abweichungen hinweist.

-   **R²: -0.01782196** – Ein negativer R²-Wert deutet darauf hin, dass das Modell die Variation des Preises pro Person nicht gut erklärt und kaum besser als zufällige Vorhersagen ist.

Die Merkmalswichtigkeit zeigt, dass die Verfügbarkeit über 365 Tage (IncNodePurity = 833646.7) der wichtigste Prädiktor ist, gefolgt von der Anzahl der Bewertungen (IncNodePurity = 718716.6) und der Bewertung der Unterkunft (IncNodePurity = 488147.3). Dies zeigt, dass die Verfügbarkeit der Unterkunft, die Anzahl der Bewertungen und die Bewertungen selbst wesentliche Faktoren bei der Preisgestaltung sind. <!--  Prescriptive analysis \[7pt\]  1.  **Präskriptiv (Prescriptive)**: Um präskriptive Analysen abzudecken, könnte die Forschung Empfehlungen entwickeln, wie Gastgeber ihre Unterkünfte modifizieren könnten, um die Attraktivität und den Preis zu maximieren. Die Frage könnte lauten: "Welche Änderungen könnten Gastgeber vornehmen, um den Preis ihrer Airbnb-Unterkünfte zu maximieren?"  -   Is the applied method reasonable for the given problem? \[2pt\]  -   Were the applied methods qualitatively performed? \[3pt\]  -   What are the conclusions of the findings? \[2pt\] -->

## 7. Schlussfolgerung (Beantwortung der Frage)

```{=html}
<!--

#\| echo: false

The `echo: false` option disables the printing of code (only output is displayed).
-->
```
## 8. Referenzen
